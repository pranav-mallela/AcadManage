


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > AcadOffice</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.users</a>
</div>

<h1>Coverage Summary for Class: AcadOffice (org.users)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">AcadOffice</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (7/7)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    92.9%
  </span>
  <span class="absValue">
    (104/112)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package org.users;
&nbsp;
&nbsp;import java.io.File;
&nbsp;import java.io.FileWriter;
&nbsp;import java.sql.*;
&nbsp;import java.util.List;
&nbsp;
&nbsp;public class AcadOffice extends User{
&nbsp;    public AcadOffice(Connection conn) {
<b class="fc">&nbsp;        super(conn);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void addCourseToCatalog(String courseCode, float l, float t, float p, List&lt;List&lt;String&gt;&gt; optionPreReqs, String courseTitle) throws SQLException
&nbsp;    {
&nbsp;        Statement statement;
&nbsp;
&nbsp;        // check if course already exists
<b class="fc">&nbsp;        int courseId = checkIfCourseExists(courseCode, false);</b>
<b class="fc">&nbsp;        if(courseId != 0) return;</b>
&nbsp;
&nbsp;        //add prerequisites to pre_req table before adding to catalog
<b class="fc">&nbsp;        if(optionPreReqs.size() != 0)</b>
&nbsp;        {
<b class="fc">&nbsp;            for (List&lt;String&gt; optionPreReq : optionPreReqs) {</b>
<b class="fc">&nbsp;                String preReqCode = optionPreReq.get(optionPreReq.size() - 1); // code of the compulsory prerequisite</b>
<b class="fc">&nbsp;                int preReqId = checkIfCourseExists(preReqCode, true);</b>
<b class="fc">&nbsp;                if (preReqId == 0) {</b>
<b class="fc">&nbsp;                    String deletePreReqQuery = String.format(&quot;DELETE FROM pre_req where course_code=&#39;%s&#39;&quot;, courseCode);</b>
<b class="fc">&nbsp;                    statement = conn.createStatement();</b>
<b class="fc">&nbsp;                    statement.executeUpdate(deletePreReqQuery);</b>
&nbsp;                    return;
&nbsp;                }
&nbsp;                // add it to the main prerequisite table
<b class="fc">&nbsp;                String addPreReqQuery = String.format(&quot;INSERT INTO pre_req(course_code, pre_req_course_id, pre_req_code) VALUES(&#39;%s&#39;, %d, &#39;%s&#39;)&quot;, courseCode, preReqId, preReqCode);</b>
<b class="fc">&nbsp;                statement = conn.createStatement();</b>
<b class="fc">&nbsp;                statement.executeUpdate(addPreReqQuery);</b>
<b class="fc">&nbsp;                if (!optionPreReq.get(0).equals(&quot;&quot;)) {</b>
&nbsp;                    //add all of its equivalents as well, to the optional prerequisite table
<b class="fc">&nbsp;                    for (int j = 0; j &lt; optionPreReq.size() - 1; j++) {</b>
&nbsp;                        // check if equivalent exists in catalog
<b class="fc">&nbsp;                        int optionCourseId = checkIfCourseExists(optionPreReq.get(j), true);</b>
<b class="fc">&nbsp;                        if (optionCourseId == 0) {</b>
<b class="fc">&nbsp;                            String deleteOptionalPreReqQuery = String.format(&quot;DELETE FROM optional_pre_req WHERE pre_req_code=&#39;%s&#39;&quot;, preReqCode);</b>
<b class="fc">&nbsp;                            statement = conn.createStatement();</b>
<b class="fc">&nbsp;                            statement.executeUpdate(deleteOptionalPreReqQuery);</b>
&nbsp;                            return;
&nbsp;                        }
&nbsp;
&nbsp;                        // add it to the optional prerequisite table
<b class="fc">&nbsp;                        String addOptionalPreReqQuery = String.format(&quot;INSERT INTO optional_pre_req(pre_req_code, option_course_id, option_code) VALUES(&#39;%s&#39;, %d, &#39;%s&#39;)&quot;, preReqCode, optionCourseId, optionPreReq.get(j));</b>
<b class="fc">&nbsp;                        statement = conn.createStatement();</b>
<b class="fc">&nbsp;                        statement.executeUpdate(addOptionalPreReqQuery);</b>
&nbsp;                    }
&nbsp;                }
<b class="fc">&nbsp;            }</b>
&nbsp;        }
&nbsp;
&nbsp;        //add course
<b class="fc">&nbsp;        String addCourseQuery = String.format(&quot;INSERT INTO course_catalog(course_code, l, t, p, course_title) VALUES(&#39;%s&#39;, %f, %f, %f, &#39;%s&#39;);&quot;, courseCode, l, t, p, courseTitle);</b>
<b class="fc">&nbsp;        statement = conn.createStatement();</b>
<b class="fc">&nbsp;        statement.executeUpdate(addCourseQuery);</b>
<b class="fc">&nbsp;        System.out.print(&quot;SUCCESS: Course successfully added to catalog!\n&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void generateTranscript(int studentId, int year, int semester) throws Exception
&nbsp;    {
&nbsp;        Statement statement;
<b class="fc">&nbsp;        ResultSet rs = null;</b>
&nbsp;
&nbsp;        // query to get the transcript of a student
<b class="fc">&nbsp;        String getCourseIdQuery = String.format(&quot;SELECT course_id FROM course_catalog WHERE course_code=s.course_code&quot;);</b>
<b class="fc">&nbsp;        String getOfferingIdQuery = String.format(&quot;SELECT offering_id FROM offerings WHERE year_offered_in=%d and semester_offered_in=%d and course_id=(%s)&quot;, year, semester, getCourseIdQuery);</b>
<b class="fc">&nbsp;        String getStudentTranscriptQuery = String.format(&quot;SELECT course_code, grade FROM student_%d s WHERE offering_id=(%s)&quot;, studentId, getOfferingIdQuery);</b>
&nbsp;
&nbsp;        // export txt file to user&#39;s computer
<b class="fc">&nbsp;        statement = conn.createStatement();</b>
<b class="fc">&nbsp;        String pathToTranscript = String.format(&quot;C:/Users/Public/Transcripts/Student_%d&quot;, studentId);</b>
<b class="fc">&nbsp;        new File(pathToTranscript).mkdirs();</b>
<b class="fc">&nbsp;        FileWriter fw = new FileWriter(String.format(&quot;%s/transcript_%d_%d.txt&quot;, pathToTranscript, year, semester));</b>
<b class="fc">&nbsp;        fw.write(String.format(&quot;Transcript of Student %d for Academic Year %d and Semester %d\n\n&quot;, studentId, year, semester));</b>
<b class="fc">&nbsp;        fw.write(&quot;course_code | grade\n&quot;);</b>
<b class="fc">&nbsp;        fw.write(&quot;------------+-------\n&quot;);</b>
<b class="fc">&nbsp;        rs = statement.executeQuery(getStudentTranscriptQuery);</b>
<b class="fc">&nbsp;        while(rs.next())</b>
&nbsp;        {
<b class="fc">&nbsp;            fw.write(&quot; &quot; + rs.getString(&quot;course_code&quot;) + &quot; &quot;.repeat(&quot;course_code&quot;.length()-5) + &quot;| &quot; + rs.getString(&quot;grade&quot;)  + &quot;\n&quot;);</b>
&nbsp;        }
<b class="fc">&nbsp;        fw.close();</b>
&nbsp;    }
&nbsp;
&nbsp;    public void viewStudentGrades(int studentId) throws SQLException
&nbsp;    {
<b class="fc">&nbsp;        Student student = new Student(conn, studentId);</b>
<b class="fc">&nbsp;        student.viewEnrolledCourseDetails();</b>
&nbsp;    }
&nbsp;
&nbsp;    public void viewOfferingGrades(int year, int semester, String courseCode) throws SQLException
&nbsp;    {
&nbsp;        Statement statement;
<b class="fc">&nbsp;        ResultSet rs = null;</b>
<b class="fc">&nbsp;        int facultyId = 0;</b>
&nbsp;
<b class="fc">&nbsp;        int courseId = checkIfCourseExists(courseCode, true);</b>
<b class="fc">&nbsp;        if(courseId == 0) return;</b>
&nbsp;
<b class="fc">&nbsp;        String getFacultyIdQuery = String.format(&quot;SELECT faculty_id FROM offerings WHERE year_offered_in=%d and semester_offered_in=%d and course_id=%d&quot;, year, semester, courseId);</b>
<b class="fc">&nbsp;        statement = conn.createStatement();</b>
<b class="fc">&nbsp;        rs = statement.executeQuery(getFacultyIdQuery);</b>
<b class="fc">&nbsp;        if(rs.next())</b>
&nbsp;        {
<b class="fc">&nbsp;            facultyId = rs.getInt(&quot;faculty_id&quot;);</b>
&nbsp;        }
<b class="fc">&nbsp;        Faculty faculty = new Faculty(conn, facultyId);</b>
<b class="fc">&nbsp;        faculty.viewGrades(year, semester, courseCode);</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean canGraduate(int studentId)
&nbsp;    {
&nbsp;        Statement statement;
<b class="fc">&nbsp;        ResultSet rs = null;</b>
&nbsp;
&nbsp;        try{
&nbsp;            // get the entry year and dept of the student
<b class="fc">&nbsp;            String getBatchIdQuery = String.format(&quot;SELECT entry_year, dept FROM students WHERE student_id=%d&quot;, studentId);</b>
<b class="fc">&nbsp;            statement = conn.createStatement();</b>
<b class="fc">&nbsp;            rs = statement.executeQuery(getBatchIdQuery);</b>
<b class="fc">&nbsp;            if(!rs.next())</b>
&nbsp;            {
<b class="fc">&nbsp;                System.out.print(&quot;UNSUCCESSFUL ACTION: Student does not exist!\n&quot;);</b>
<b class="fc">&nbsp;                return false;</b>
&nbsp;            }
<b class="fc">&nbsp;            int entryYear = rs.getInt(&quot;entry_year&quot;);</b>
<b class="fc">&nbsp;            String dept = rs.getString(&quot;dept&quot;);</b>
&nbsp;
&nbsp;            // check if student has completed all the core courses
<b class="fc">&nbsp;            String checkCoreCompletion = String.format(&quot;&quot; +</b>
&nbsp;                    &quot;SELECT * &quot; +
&nbsp;                    &quot;FROM pc_2020_cse &quot; +
&nbsp;                    &quot;WHERE course_code NOT IN ( &quot; +
&nbsp;                    &quot;  SELECT course_code &quot; +
&nbsp;                    &quot;  FROM student_1 &quot; +
&nbsp;                    &quot;  WHERE grade &lt;&gt; &#39;E&#39; AND grade &lt;&gt; &#39;E-&#39; AND grade &lt;&gt; &#39;F&#39; &quot; +
&nbsp;                    &quot;)&quot;);
<b class="fc">&nbsp;            rs = statement.executeQuery(checkCoreCompletion);</b>
<b class="fc">&nbsp;            if(rs.next())</b>
&nbsp;            {
<b class="fc">&nbsp;                System.out.print(&quot;UNSUCCESSFUL ACTION: Student has not completed all the core courses!\n&quot;);</b>
<b class="fc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;
&nbsp;            // check if the student has completed all the elective courses
<b class="fc">&nbsp;            String checkElectiveCompletion = String.format(&quot;&quot;&quot;</b>
&nbsp;                    SELECT el_%d_%s.course_category as course_category, SUM(course_catalog.c) as sum
&nbsp;                    FROM
&nbsp;                      student_%d
&nbsp;                      JOIN el_%d_%s ON student_%d.course_code = el_%d_%s.course_code
&nbsp;                      JOIN course_catalog ON student_%d.course_code = course_catalog.course_code
&nbsp;                    WHERE
&nbsp;                      student_%d.course_code IN (SELECT course_code FROM el_%d_%s)
&nbsp;                      AND student_%d.grade &lt;&gt; &#39;E&#39; AND student_%d.grade &lt;&gt; &#39;E-&#39; AND student_%d.grade &lt;&gt; &#39;F&#39;
&nbsp;                    GROUP BY el_%d_%s.course_category;
<b class="fc">&nbsp;                    &quot;&quot;&quot;, entryYear, dept, studentId, entryYear, dept, studentId, entryYear, dept, studentId, studentId, entryYear, dept, studentId, studentId, studentId, entryYear, dept);</b>
<b class="fc">&nbsp;            rs = statement.executeQuery(checkElectiveCompletion);</b>
<b class="fc">&nbsp;            if(!rs.next())</b>
&nbsp;            {
<b class="fc">&nbsp;                System.out.print(&quot;UNSUCCESSFUL ACTION: Student has not completed all the elective courses!\n&quot;);</b>
<b class="fc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;            else{
<b class="fc">&nbsp;                int totalElectiveCredits = 0;</b>
<b class="fc">&nbsp;                for(int i=0;i&lt;3;i++)</b>
&nbsp;                {
<b class="fc">&nbsp;                    int creditsEarned = rs.getInt(&quot;sum&quot;);</b>
<b class="fc">&nbsp;                    if(creditsEarned &lt; 6)</b>
&nbsp;                    {
<b class="nc">&nbsp;                        System.out.print(&quot;UNSUCCESSFUL ACTION: Student has not completed all the elective courses!\n&quot;);</b>
<b class="nc">&nbsp;                        return false;</b>
&nbsp;                    }
<b class="fc">&nbsp;                    totalElectiveCredits += creditsEarned;</b>
<b class="fc">&nbsp;                    rs.next();</b>
&nbsp;                }
<b class="fc">&nbsp;                if(totalElectiveCredits &lt; 24)</b>
&nbsp;                {
<b class="nc">&nbsp;                    System.out.print(&quot;UNSUCCESSFUL ACTION: Student has not completed all the elective courses!\n&quot;);</b>
<b class="nc">&nbsp;                    return false;</b>
&nbsp;                }
&nbsp;            }
&nbsp;
&nbsp;            // check if the student completed all the extracurricular and capstone courses
<b class="fc">&nbsp;            String checkExtracurricularCompletion = String.format(&quot;&quot;&quot;</b>
&nbsp;                   SELECT extra_cap_%d.course_category as course_category, SUM(course_catalog.c) as sum
&nbsp;                   FROM
&nbsp;                     student_%d
&nbsp;                     JOIN extra_cap_%d ON student_%d.course_code = extra_cap_%d.course_code
&nbsp;                     JOIN course_catalog ON student_%d.course_code = course_catalog.course_code
&nbsp;                   WHERE
&nbsp;                     student_%d.course_code IN (SELECT course_code FROM extra_cap_%d)
&nbsp;                     AND student_%d.grade &lt;&gt; &#39;E&#39; AND student_%d.grade &lt;&gt; &#39;E-&#39; AND student_%d.grade &lt;&gt; &#39;F&#39;
&nbsp;                   GROUP BY extra_cap_%d.course_category;
<b class="fc">&nbsp;                    &quot;&quot;&quot;, entryYear, studentId, entryYear, studentId, entryYear, studentId, studentId, entryYear, studentId, studentId, studentId, entryYear);</b>
<b class="fc">&nbsp;            rs = statement.executeQuery(checkExtracurricularCompletion);</b>
<b class="fc">&nbsp;            if(!rs.next())</b>
&nbsp;            {
<b class="fc">&nbsp;                System.out.print(&quot;UNSUCCESSFUL ACTION: Student has not completed all the extracurricular and capstone courses!\n&quot;);</b>
<b class="fc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;            else{
<b class="fc">&nbsp;                for(int i=0;i&lt;3;i++)</b>
&nbsp;                {
<b class="fc">&nbsp;                    float creditsEarned = rs.getFloat(&quot;sum&quot;);</b>
<b class="fc">&nbsp;                    if((i == 0 &amp;&amp; creditsEarned &lt; 9) || (i == 1 &amp;&amp; creditsEarned &lt; 3.5) || (i == 2 &amp;&amp; creditsEarned &lt; 4))</b>
&nbsp;                    {
<b class="nc">&nbsp;                        System.out.print(&quot;UNSUCCESSFUL ACTION: Student has not completed all the extracurricular and capstone courses!\n&quot;);</b>
<b class="nc">&nbsp;                        return false;</b>
&nbsp;                    }
<b class="fc">&nbsp;                    rs.next();</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;        } catch (SQLException e)</b>
&nbsp;        {
<b class="nc">&nbsp;            System.out.print(e);</b>
<b class="fc">&nbsp;        }</b>
<b class="fc">&nbsp;        System.out.print(&quot;SUCCESS: Student eligible for graduation!\n&quot;);</b>
<b class="fc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setSemesterEvent(int action) throws SQLException
&nbsp;    {
&nbsp;        Statement statement;
&nbsp;
<b class="fc">&nbsp;        String setSemesterEventQuery = &quot;UPDATE semester_events SET is_open=0::BOOLEAN&quot;;</b>
<b class="fc">&nbsp;        statement = conn.createStatement();</b>
<b class="fc">&nbsp;        statement.executeUpdate(setSemesterEventQuery);</b>
<b class="fc">&nbsp;        String setSemesterEventQuery2 = String.format(&quot;UPDATE semester_events SET is_open=1::BOOLEAN WHERE event_id=%d&quot;, action);</b>
<b class="fc">&nbsp;        statement = conn.createStatement();</b>
<b class="fc">&nbsp;        statement.executeUpdate(setSemesterEventQuery2);</b>
<b class="fc">&nbsp;        System.out.print(&quot;SUCCESS: Semester event set\n&quot;);</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-03-06 10:05</div>
</div>
</body>
</html>
